<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Airplane Noise In Somerville</title>
        <style>
            :root {
                --bg-color: #fff;
                --color: #333;
                --color-bright: #000;
                --accent-color: aquamarine;
                --accent-color-bright: rgb(55, 255, 188);
            }
            body {
                padding: 20px;
                margin: 0;
                font-family: sans-serif;
                background-color: var(--bg-color);
                color: var(--color);
            }
            header,
            aside,
            main,
            footer {
                max-width: 800px;
                margin: 0 auto;
            }
            a {
                color: inherit;
            }
            aside {
                display: flex;
            }
            h1,
            .report {
                font-size: 28px;
                font-weight: 500;
            }
            .report + .report {
                margin-left: 1em;
            }
            .report {
                display: block;
                text-decoration: none;
                padding: 1em;
                margin-bottom: 1em;
            }
            .report {
                background-color: var(--accent-color);
            }
            .report:hover {
                background-color: var(--accent-color-bright);
                color: var(--color-bright);
            }
            svg[class^="plot-"] {
                background-color: var(--bg-color);
                color: var(--color);
            }
            select {
                display: block;
            }
            @media screen and (max-width: 600px) {
                body {
                    padding: 10px;
                }
                aside {
                    flex-direction: column;
                }
                .report + .report {
                    margin-left: 0;
                }
            }

            @media (prefers-color-scheme: dark) {
                :root {
                    --bg-color: #0e0f10;
                    --color: #c4c1bd;
                    --color-bright: #fff;
                    --accent-color: rgb(18, 79, 63);
                    --accent-color-bright: rgb(0, 96, 72);
                }
            }
        </style>
    </head>
    <body>
        <header>
            <h1>Are you bothered by airplane noise in Somerville, MA?</h1>
            <p>
                You're not alone. The best way to get the FAA to change flight
                patterns is to tell them they're bothering you.
            </p>
        </header>
        <aside>
            <a
                id="massport"
                class="report"
                href="https://docs.google.com/forms/d/e/1FAIpQLSd9lQhA1a8Z9eCDLkyN6WnxCIftcMMxhZfkvecysKH4MytSlA/viewform"
                >Report noise to Massport</a
            >

            <a id="faa" class="report" href="https://noise.faa.gov/noise/"
                >Report noise to the FAA</a
            >
        </aside>
        <main>
            <h1>Noise complaints are increasing</h1>
            <div id="somerville-plot"></div>

            <p>
                The number of noise complaints has increased dramatically over
                the past few years. My hypothesis is that the initial spike is
                from a flight route change, and the subsequent drop is from a
                reduction in flights due to the covid state of emergency. As
                covid restrictions eased and people became more comfortable
                flying, noise increased to the pre-pandemic peak.
            </p>

            <p>
                <a href="data.csv">Data</a> scraped from
                <a
                    href="https://www.massport.com/logan-airport/about-logan/noise-abatement/complaints-by-townss/"
                    >Massport</a
                >
                pdf reports.
            </p>
        </main>
        <footer>
            <p>Made by <a href="https://cypressf.com">Cypress</a></p>
        </footer>
        <script type="module">
            import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm";
            import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

            const somervilleDiv = document.querySelector("#somerville-plot");
            const maxWidth = parseInt(
                window.getComputedStyle(document.querySelector("main"))
                    .maxWidth,
                10
            );
            const data = await d3.csv("data.csv", d3.autoType);
            const stateOfEmergency = {
                x: new Date("2020-03-10"),
                x2: new Date("2021-06-15"),
            };
            const somervilleData = data.filter(
                (d) => d.community === "Somerville"
            );

            const baseMarks = (filter) => [
                Plot.areaY(data, {
                    filter,
                    x: "date",
                    y: "complaints",
                    curve: "step",
                }),
                Plot.gridX({ interval: d3.utcYear.every(1) }),
            ];

            const plot = (width) => {
                const baseConfig = {
                    marginLeft: 50,
                    width,
                    height: 200,
                    y: {
                        domain: [0, 6000],
                    },
                };

                const somervillePlot = Plot.plot({
                    ...baseConfig,
                    marks: baseMarks((d) => d.community === "Somerville"),
                });

                somervilleDiv.replaceChildren(somervillePlot);
            };

            // set plot width when window resizes
            window.addEventListener("resize", () => {
                if (somervilleDiv.clientWidth < maxWidth) {
                    plot(somervilleDiv.clientWidth);
                    console.log(
                        `update plot width ${somervilleDiv.clientWidth}`
                    );
                }
            });

            plot(somervilleDiv.clientWidth);
        </script>
    </body>
</html>
